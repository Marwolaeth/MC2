# Rate of change {#sec-rate-of-change}

```{r child="../starter.Rmd"}
```

## Slopes and motion

Consider a graph of the position of a car along a road as in @fig-stop-and-go.  Over the course of an hour, the car traveled about 25 miles. In other words, the ***average*** speed is 25 miles/hour: the *slope* of the tan-colored line segment. Given the traffic, sometimes the car was stopped (time C), sometimes crawling (time D) and sometimes much faster than average (time B).   

```{r echo=FALSE}
#| label: fig-stop-and-go2
#| fig-cap: "The position of an imagined car over an hour of time. (black) The tan-colored line shows what the position would have been if the car had travelled steadily at the average speed for the hour."
f <- rfun(~ t, seed=105, n=5)
raw <- function(t) 
        f(t) - t - 30*dnorm(t, 0, 3) + 60*dnorm(t,7,1)
speed <- function(t) {
    pmax(4*raw(20*(t-.5)), 0)
}
position <- antiD(speed(t) ~ t)
Pts <- tibble::tibble(
    t = c(0, 0.19, 0.4, 0.54, 0.65, 1),
    y = position(t) + 2,
    label=c("", "A", "B", "C", "D", "")
)
Intervals <- tibble::tribble(
    ~t0, ~ t1, ~color,
    0, 1, "orange3",
    # .54, .65, "orange",
    # .19, .4, "green",
    # .4, .54, "brown",
) %>%
    mutate(y0=position(t0), y1=position(t1))
FigA <- slice_plot(position(t) ~ t, domain(t = c(0, 1)), size=2) %>%
    gf_labs(y = "f(t): distance traveled (miles)",
            x = "Time since start (hours)") %>%
    gf_text(0 ~ t, data = Pts, label=~label, color="dodgerblue") %>%
    gf_segment(2 + y ~ t + t, data = Pts[-6,], color="dodgerblue") %>%
    gf_segment(y0 + y1 ~ t0 + t1, data = Intervals, color=~color, alpha=0.5, size=3) %>%
    gf_refine(scale_color_identity())
FigA
```

When driving, you are aware of the car's speed at any instant. You need only look at the speedometer to read off the value (in miles per hour). Speedometers don't show the average speed for the entire trip. The average speed is the slope of the tan-colored line in @fig-stop-and-go, 25 miles in one hour, usually stated 25 miles-per-hour. 

In terms of @fig-stop-and-go, the speedometer reading is the **slope** of $f(t)$ at the given instant. You can see from the Figure that at instant A the speed is very close to the average speed for the entire trip. At instant B the car is going faster; the slope is much steeper. On the other hand, at instant C the car is at a standstill; its position doesn't change at all. 

A car's speedometer shows the speed at each moment---or ***instant***---of the trip. As you can see in @fig-stop-and-go, the speed varies and is sometimes less than the average speed, sometimes greater, and occasionally equal to the average speed over the trip.  

From a graph of $f(t)$, you can easily judge whether the instantaneous speed is faster or slower than the average speed. Better, however, if we simply record the speedometer reading and graph that, as in @fig-instant-speed. Read off the speed from the graph at any instant of time by reference to the vertical axis.

```{r echo=FALSE}
#| label: fig-instant-speed
#| fig-cap: "The ***instantaneous*** speed of the car whose position vs time is shown in @fig-stop-and-go2."
f <- rfun(~ t, seed=105, n=5)
raw <- function(t) 
        f(t) - t - 30*dnorm(t, 0, 3) + 60*dnorm(t,7,1)
speed <- function(t) {
    pmax(4*raw(20*(t-.5)), 0)
}
Pts <- tibble::tibble(
    t = c(0, 0.19, 0.4, 0.56, 0.65, 1),
    y = speed(t) + 5,
    label=c("", "A", "B", "C", "D", "")
)
FigB <- slice_plot(speed(t) ~ t, domain(t=c(0,1)), npts=500) %>%
    gf_labs(y = "Instantaneous speed (miles/hour)", 
           x = "Time since start of trip.") %>%
    gf_text(2 ~ t, data = Pts, label=~label, color="dodgerblue") %>%
    gf_segment(5 + y ~ t + t, data = Pts[-1,], color="dodgerblue")
FigB
```
The two graphs in Figures \@ref(fig:stop-and-go2) and \@ref(fig:instant-speed) show the same car trip. For each of the two graphs, the presentation of the data makes it easy to see some things and hard to see others. For instance, figuring out when the car is at a standstill is harder in the position-vs-time graph than in the speed-vs-time graph. 


## Visualizing the slope function {#sec-slope-fun-visualization}

Look back at @fig-stop-and-go2 and @fig-instant-speed (which we reproduce here). We know the two functions are closely related---one is the position of the car and the other the speed. But it's hard to see the relationship at a glance. You have to go patiently back and forth between the two graphs, comparing a slope in one graph to an output value in the other graph.

```{r echo=FALSE}
#| out-width: "50%"
#| fig-show: "hold"
FigA
FigB
```

We can make things easier by taking an unconventional approach to graphing the slope function. Rather than showing the slope as the vertical position on a graph, let's show the slope with an actual slope! Perhaps this non-standard visualization will give you a better way to understand slope functions. If so, good. The ultimate benefit of a way to show $\diff{x} f(x)$ and $f(x)$ in the same frame will come when we introduce the operation of ***anti-differentiation***. 

Recall that the ***basic model of change*** in Calculus is the straight-line function $\line(x) \equiv a x + b$. The slope $a$ of $\line(x)$ tells how the output changes for a unit change in input. In differentiation, we  

i. approximate the parent function $f(x)$ as a series of local line segments.
ii. extract the **slope** of each line segment as the value of the slope function at each input $x$. 

@fig-segment-approx shows the segment by segment approximation around each of several input values (marked in green).  The ***slope function visualization*** is constructed by throwing away the vertical offset of each of the line segments and plotting them horizontally adjacent to one another. 

```{r echo=FALSE}
#| label: fig-segment-approx
#| fig-cap: "A function $f(x)$ shown along with the tangent line segment touching $f()$ at each of the green points. For the slope function visualization, the tangent line segments are moved down to the horizontal axis."
Segs <- create_segments(sin(x) ~ x, domain(x=c(-.1,pi)), nsegs=10)
gf_segment(yf + yfend ~ x + xend, data = Segs, 
           color=~slope,size=2, alpha=.9) %>%
    gf_refine(scale_color_viridis_c(begin=.3, end=1)) %>%
    slice_plot(sin(x) ~ x, color="black", domain(x=c(0, pi)),
               alpha = 0.85, size=1, inherit=FALSE) %>%
    gf_point(offset ~ start, size=1, color="green") %>%
    gf_segment(y + yend ~ x + xend, data = Segs, 
           color=~slope,size=1.3, lineend="round") %>%
    gf_point(0 ~ start, size=1, color="green") %>% 
  gf_labs(y = "f(x)")  
    
```
You can see that the slopes are a function of $x$, that is, the slope changes with $x$. Because the function and its slope function are shown on the same graph in the same way, it's easy to verify that the slope as a function of $x$ corresponds to the behavior of the function itself.


```{r eval=FALSE, echo=FALSE}
#| label: fig-finer-slope
## Leaving this figure out
Segs <- create_segments(sin(x) ~ x, domain(x=c(-.1,pi)), nsegs=100)
# gf_segment(yf + yfend ~ x + xend, data = Segs, 
#            color=~slope,size=2, alpha=.9) %>%
#     gf_refine(scale_color_continuous(type="gradient")) %>%
#     slice_plot(sin(x) ~ x, color="orange3", domain(x=c(0, pi)),
#                alpha = 0.5, size=1, inherit=FALSE) %>%
#     gf_point(offset ~ start, size=1, color="green") %>%
  gf_segment(y + yend ~ x + xend, data = Segs, 
           color=~slope,size=0.3) %>%
  gf_labs(y = "output") %>%
    gf_refine(coord_fixed(ratio=5), 
              scale_y_continuous(breaks=c(-0.01, 0.01)))  %>%
    gf_refine(scale_color_viridis_c())
    
```


@fig-slope-visualization-examples shows several examples of the slope function visualization.

```{r echo=FALSE, fig.height=3, fig.width=7, fig.show="hold", out.width="100%"} 
#| label: fig-slope-visualization-examples
#| fig-cap: "Slope-function visualizations (left) of several pattern-book functions (right)."
Segs <- create_segments(exp(x) ~ x, domain(x=c(-pi,pi)), nsegs=30)

ggpubr::ggarrange(
  slice_plot(exp(x) ~ x, domain(x=c(-pi, pi))) %>%
    gf_labs(title="exp(x)"),
gf_segment(y + yend ~ x + xend, data = Segs, 
           color=~slope,size=1.3, lineend="round") %>%
  gf_point(0 ~ start, size=1, color="green") %>%
    gf_labs(title="exp(x) slope-function visualization")  %>%
    gf_refine(scale_color_viridis_c(begin=.3, end=1)) %>%
  gf_theme(theme(legend.position = "none")), ncol = 2)
Segs <- create_segments(log(x) ~ x, domain(x=c(.2,pi)), nsegs=30)
ggpubr::ggarrange(
  slice_plot(log(x) ~ x, domain(x=c(.2, pi))) %>%
    gf_labs(title="log(x)"),
gf_segment(y + yend ~ x + xend, data = Segs, 
           color=~slope,size=1.3, lineend="round") %>%
  gf_point(0 ~ start, size=1, color="green") %>%
    gf_labs(title="log(x) slope-function visualization")  %>%
    gf_refine(scale_color_viridis_c(begin=.3, end=1)) %>%
  gf_theme(theme(legend.position = "none")), ncol = 2)
Segs <- create_segments(x^2 ~ x, domain(x=c(-pi,pi)), nsegs=30)
ggpubr::ggarrange(
  slice_plot(x^2 ~ x, domain(x=c(-pi, pi))) %>%
    gf_labs(title=expression(x^2)),
gf_segment(y + yend ~ x + xend, data = Segs, 
           color=~slope,size=1.3, lineend="round") %>%
  gf_point(0 ~ start, size=1, color="green") %>%
    gf_labs(title=expression(paste("x^2 slope-function visualization")))  %>%
    gf_refine(scale_color_viridis_c(begin=.3, end=1)) %>%
  gf_theme(theme(legend.position = "none")), ncol=2)
Segs <- create_segments(2*x -4 ~ x, domain(x=c(-pi,pi)), nsegs=30)
ggpubr::ggarrange(
  slice_plot(2*x - 4 ~ x, domain(x=c(-pi, pi))) %>%
    gf_labs(title="2x - 4"),
gf_segment(y + yend ~ x + xend, data = Segs, 
           color=~slope,size=1.3, lineend="round") %>%
  gf_point(0 ~ start, size=1, color="green") %>%
    gf_labs(title="line(x) = 2 x - 4 slope-function visualization") %>%
    gf_lims(y=c(-1,1))  %>%
    gf_refine(scale_color_viridis_c(begin=.3, end=1)) %>%
  gf_theme(theme(legend.position = "none")), ncol=2)
```



## Acceleration (rename to "Second increments"????)

Having worked out a theory of slope functions, Newton was ready to express the laws of motion in continuous time. He did this by denoting position as $x(t)$. He defined velocity and force in terms of slope functions of position and the "quantity of matter," which we call "mass."  

- Velocity is the slope function of position: $v(t) \equiv {\cal D}_t x(t)$.
- Net force is the slope function of velocity times mass: $F(t) \equiv m {\cal D}_t v(t) = m {\cal D}_{tt} x(t)$ 

To take mass out of the formulation, we give a name specifically to the slope function of velocity: ***acceleration***. 

- Acceleration is the slope function of velocity: $a(t) \equiv {\cal D}_t v(t) = {\cal D}_{tt} x(t)$.

Having defined acceleration, we can express net force as mass times acceleration. This is ***Newton's Second Law of Motion***.

::: {.why  data-latex=""}
We used **net force** as the quantity we related to mass and the slope function of velocity. There are different sources of forces that add up and can cancel out. Famously, Newton formulated the ***law of universal gravitation***, which ascribed the force between masses as proportional to the product of the two masses and inversely proportional to the square of the distance between them. But a mass on a table is subject to no net force, since the table pushes back (push = force) on the mass to cancel out the force due to gravity. "Net force" takes such cancellation into account. 
:::




## Dimension of a rate of change

The function named $\partial_t f(t)$ which is the derivative of $f(t)$ takes the same input as $f(t)$; the notation makes that pretty clear. Let's suppose that $t$ is time and so the dimension of the input is $[t] = \text{T}$.

The outputs of the two functions, $\partial_t f(t)$ and $f(t)$ will not, in general, have the same dimension. Why not? Recall that a derivative is a special case of a slope function, the ***instantaneous slope function***. It's easy to calculate a slope function:

$${\cal D}_t f(t) \equiv \frac{f(t+h) - f(t)}{h}$$
The dimension of the quantity $f(t+h) - f(t)$ must be the same as the dimension of $f(t)$; the subtraction wouldn't be possible otherwise. The dimension of $h$, similarly, must be the same as the dimension of $t$; the addition wouldn't make sense otherwise. 

Whereas the dimension of the output $f(t)$ is simply $\left[f(t)\right]$, the dimension of the quotient $\frac{f(t+h) - f(t)}{h}$ will be different. The output of the derivative function $\partial_t f(t)$ will be $$\left[\partial_t f(t)\right] = \left[f(t)\right] / \left[t\right] .$$ 

Suppose $x(t)$ is the position of a car as a function of time $t$. Position has dimension L. Time has dimension T. The function $\partial_t x(t)$ will have dimension L/T; that's what velocity is, for instance miles-per-hour.

Another example: Imagine a function pressure() with input altitude i(in km) and output pressure (in kPa, "kiloPascal"^[Air pressure at sea level is about 100 kiloPascal.]).

The derivative function, let's call it $\partial_\text{altitude} \text{pressure}()$, also takes an input in km, but produces an output in kPA per km: a rate.


## Slope at a point

Show the tangent line and it's slope


## Exercises


<!-- Drill

`r Znotes:::MC_counter$reset(labels="roman")`





```{r drill-Quiz-2-28, echo=FALSE, results='markup'}
askMC(
  prompt = r"(What is the average rate of change of this function on the interval $-5 < t < 5?<br><img src="https://raw.githubusercontent.com/dtkaplan/Zdrill/main/inst/rev2/rev2-09.png" width="80%"><br>(Choose the closest answer.) )",
r"(+0.5+)" = r"(Rise is 5, run is 10.)",
  r"(1)" = r"( )",
  r"(1.5)" = r"( )",
  r"(2)" = r"( )",
  random_answer_order=FALSE
)
```



```{r drill-Quiz-2-29, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Consider the average rate of change of this function on the interval $-2 < t < 2$. <br><img src="https://raw.githubusercontent.com/dtkaplan/Zdrill/main/inst/rev2/rev2-09.png" width="80%"><br>Which of these statements best describes that average rate of change. )",
r"(very close to 1/2)" = r"( )",
  r"(+slightly less than 1+)" = r"( )",
  r"(slightly greater than 1)" = r"( )",
  r"(very close to 2)" = r"( )",
  random_answer_order=FALSE
)
```

