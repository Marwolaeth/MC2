# Constructing derivatives {#sec-computing-derivs}

```{r child="../starter.Rmd"}
```



## Acceleration (rename to "Second increments"????)

Having worked out a theory of slope functions, Newton was ready to express the laws of motion in continuous time. He did this by denoting position as $x(t)$. He defined velocity and force in terms of slope functions of position and the "quantity of matter," which we call "mass."  

- Velocity is the slope function of position: $v(t) \equiv {\cal D}_t x(t)$.
- Net force is the slope function of velocity times mass: $F(t) \equiv m {\cal D}_t v(t) = m {\cal D}_{tt} x(t)$ 

To take mass out of the formulation, we give a name specifically to the slope function of velocity: ***acceleration***. 

- Acceleration is the slope function of velocity: $a(t) \equiv {\cal D}_t v(t) = {\cal D}_{tt} x(t)$.

Having defined acceleration, we can express net force as mass times acceleration. This is ***Newton's Second Law of Motion***.

::: {.why  data-latex=""}
We used **net force** as the quantity we related to mass and the slope function of velocity. There are different sources of forces that add up and can cancel out. Famously, Newton formulated the ***law of universal gravitation***, which ascribed the force between masses as proportional to the product of the two masses and inversely proportional to the square of the distance between them. But a mass on a table is subject to no net force, since the table pushes back (push = force) on the mass to cancel out the force due to gravity. "Net force" takes such cancellation into account. 
:::





## Symbolic differentiation {#sec-symbolic-differentiation}

Symbolic differentiation is the process of taking a formula and translating it to a new formula according to certain patterns or ***rules***. Each rule is ultimately derived from the definition of the slope function and the differencing operator. 

As you recall, the ***differencing operator*** $\diff{x}$ turns a function into its slope function
$$\diff{x} f(x) \equiv \frac{f(x+h) - f(x)}{h}$$

### The line rule

Let's look at one where we already know the result: The straight-line function $\line(x) \equiv a x + b$ has a slope function that is constant: $\diff{x}\line(x) = a$


$$\diff{x}\line(x) = \frac{\line(x+h) - \line(x)}{h} = \frac{\left[\strut a (x+h) + b\right] - \left[\strut a x + b\right]}{h} = \frac{ah}{h} = a$$
The derivative is the slope function with $h$ made as small as possible. It's tempting to think of this as $h = 0$, but that would imply dividing by zero in the differencing operator. 

Being wary about the possibility of dividing by zero, mathematicians adopt a convention that indicates clearly that $h$ is to be small, but **not zero**. This convention is marked with the notation $\lim_{h \rightarrow 0}$, which means "as close as you can get to zero, but not zero exactly". 

$$\partial_x \line(x) \equiv \lim_{h\rightarrow 0} \frac{\line(x+h) - \line(x)}{h} =\\
\ \\
= \lim_{h\rightarrow 0} \frac{a h}{h} = a$$

This derivation is unarguably correct for any non-zero $h$. 

This short derivation gives us a basic differentiation rule which we can divide into 3 special cases. 

- **Line rule**: $\partial_x ax + b = a$
    i. $\partial_x ax = a$. The function $ax$ is $\line(x)$ with $b=0$.
    ii. $\partial_x b = 0$. The function $b$ is $\line(x)$ with $a=0$ and thus is the constant function.
    iii. $\partial_x x = 1$. The function $x$ is $\line(x)$ with $a=1$ and $b=0$. 
    
Remember that $\partial_x f(x)$ is always a function no matter what kind of function $f(x)$ is. The functions associated with the line rule are all ***constant functions***, meaning the output doesn't depend on the input.

### The square rule

Only for the $\line()$ function and its three special cases is the derivative a constant function. And $\line()$ is the only function for which the $h$ in the differencing operator disappears on its own. For instance, consider the square function: $g(x) \equiv x^2$.  

\begin{eqnarray}
\partial_x [x^2] & = & \lim_{h\rightarrow 0}\frac{(x+h)^2 - x^2}{h}\\
& = & \lim_{h\rightarrow 0}\frac{(x^2 + 2 x h + h^2) - x^2}{h}\\  
& = & \lim_{h\rightarrow 0}\frac{2 x h + h^2}{h} \\
& = &\lim_{h\rightarrow 0} [2x + h]\\
\end{eqnarray}

It's accepted that the limit of a sum is the sum of the limits, so ...
$$\lim_{h\rightarrow 0} \left[\strut 2 x + h\right]= \lim_{h\rightarrow 0} 2x + \lim_{h\rightarrow 0}h$$
The limit of something not involving $h$ is just that thing, giving  $$\lim_{h\rightarrow 0}2x = 2x\ .$$
Finally, when an expression including $h$ doesn't involve division by $h$, we can remove the $\lim_{h\rightarrow 0}$ and just use $h=0$ instead, so $$\lim_{h\rightarrow 0} h = 0\ .$$

Putting these together gives

$$\partial_x [x^2] = 2x + \lim_{h\rightarrow 0}h = 2x$$


We'll write this as another differentiation rule.

- **Quadratic rule**: $\partial_x [x^2] = 2x$

### The exponential rule


Let's take on the exponential function $h(x) \equiv e^x$:

$$\partial_x e^x = \lim_{h\rightarrow 0}\frac{e^{x+h} - e^x}{h} = e^x \lim_{h\rightarrow 0}\left[\frac{e^h - 1}{h}\right]$$
At a glance, it can be hard to know what to make of $\lim_{h\rightarrow 0} (e^h-1)/h$. Setting $h=0$ in the denominator is perfectly legitimate and gives $e^0 - 1 = 0$. But that still leaves the $h$ in the numerator. Still, for any non-zero $h$, the division is legitimate, so let's see what happens as $h \rightarrow 0$:

```{r}
f <- makeFun((exp(h) - 1)/h ~ h)
f(0.1)
f(0.01)
f(0.001)
f(0.0001)
f(0.0000001)
f(0.0000000001)
```

Setting $h$ exactly to zero, however, won't work: it produces `NaN`.

```{r}
f(0)
```

Since $\lim_{h\rightarrow 0} (e^h-1)/h = 1$, we have

* **Exponentiation rule**: $\partial_x e^x = e^x$

### The reciprocal rule

Still another example: the reciprocal function, written equivalently as $1/x$ or $x^{-1}$

\begin{eqnarray}
\partial x^{-1} & = &\lim_{h\rightarrow 0}\frac{\frac{1}{x+h} - \frac{1}{x}}{h} \\
& = & \lim_{h\rightarrow 0} \frac{\frac{x - (x+h)}{x(x+h)}}{h}\\
& = & \lim_{h\rightarrow 0}\frac{x - x+h}{x(x+h)h} = -\lim_{h\rightarrow 0}\frac{h}{x(x+h)h} \\
& = & -\lim_{h\rightarrow 0}\frac{1}{x^2 + hx}
\end{eqnarray}
So long as $x \neq 0$, there is no divide-by-zero problem even when $h=0$, but let's see what the computer thinks:

```{r}
g <- makeFun(-1/(x^2 + h*x) ~ h, x=10)
g(0.1)
g(0.01)
g(0.001)
g(0.0001)
g(0.0000001)
g(0.0000000001)
g(0)
```

Setting $h$ to zero in the last expression gives another differentiation rule:

* **Reciprocal rule**: $\partial_x \frac{1}{x} = -\frac{1}{x^2}$

### Power-law rule

We don't yet have the tools needed to prove a formula for the derivative of power-law functions, but we already have some instances where we know the derivative:

- $\partial_x x^2 = 2 x$
- $\partial_x x^1 = 1$
- $\partial_x x^0 = 0$

A rule that fits all these examples is $$\partial_x x^p = p\, x^{p-1}\ .$$
For instance, when $p=2$ the rule gives $$\partial_x x^2 = 2\, x^1 = 2 x$$ since $p-1$ will be 1$.

It's not too hard to do the algebra to find the derivative of $x^3$. According to the proposed rule, the derivative should be $$\partial_x x^3 = 3 x^2\ .$$ Let's check this via the definition of the derivative:
$$\partial_x x^3 = \lim_{h \rightarrow 0}\frac{(x+h)^3 - x^3}{h}$$
Direct multiplication $(x+h)(x+h)(x+h)$ gives
$$(x+h)^3 = x^3 + 3\, x^2 h + 3\, x h^2 + h^3$$
Consequently, the limit definition amounts to:
$$\partial_x x^3 = \lim_{h\rightarrow 0}\frac{3\, x^2 h + 3\, x h^2 + h^3}{h} = \lim_{h\rightarrow 0} \left[\strut 3\, x^2 + 3\,x h + h^2\right]$$
But there is no divide-by-$h$ in sight, so we can resolve $\lim_{h\rightarrow 0}$ to $h=0$, giving
$$\partial_x x^3 = 3 x^2\ ,$$ consistent with the proposed rule. 


### List of pattern-book rules {#sec-pattern-book-derivs}

We'll save for later the derivation of the derivatives of the other pattern-book functions, but note that the gaussian function is **defined** to be the derivative of the sigmoidal function.

Name | $f(x)$ | $\partial_x f(x)$   | demonstrated already
-----|---------------|------------------
exponential | $e^x$     | $e^x$ | yes
logarithm (natural)  | $\ln(x)$  | $1/x$  | not yet
sinusoid    | $\sin(x)$ | $\cos(x)$ | not yet
square | $x^2$  | $2x$ | yes
proportional | $x$   | $1$ | yes
constant | 1  | 0 | yes
reciprocal | $1/x$ or $x^{-1}$   | $-1/x^2$ | yes
gaussian (hump)     |  $\dnorm(x)$           |  $-x\, \dnorm(x)$ | not yet
sigmoid  |  $\pnorm(x)$            |  $\dnorm(x)$ | by definition


```{r echo=FALSE}
#| label: fig-pattern-deriv-diag
#| fig-cap: "A diagram showing how differentiation connects the pattern-book functions to one another."
knitr::include_graphics("www/pattern-derivs-diagram.png")
```

## Exercises

<!-- Drill

`r Znotes:::MC_counter$reset(labels="roman")`


```{r drill-Pattern-book-derivs-1, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which pattern-book function is the **derivative** of the sigmoid function pnorm()? That is, $${\large \text{pnorm}(x)}  \underset{\scriptsize \text{anti-diff}}{{\stackrel{\text{diff}}{\ \ \ \ {\Huge\rightleftharpoons}\ \ \ }}}  {\LARGE ?}$$  )",
r"(Reciprocal $1/x$)" = r"(The anti-derivative of the reciprocal is the natural logarithm.)",
  r"(Exponential $e^x$)" = r"(The anti-derivative of the exponential is the exponential.)",
  r"(Sinusoid $\sin(x)$)" = r"(The anti-derivative of a sinusoid is a shifted sinusoid.)",
  r"(+Gaussian dnorm(x)+)" = r"(The anti-derivative of the gaussian is the sigmoid.)",
  r"(Constant $1$)" = r"(The anti-derivative of the constant function is the identity function $x$.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-2, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which pattern-book function is the **anti-derivative** of the reciprocal $1/x$? That is, $${\LARGE ?}  \underset{\scriptsize \text{anti-diff}}{{\stackrel{\text{diff}}{\ \ \ \ {\Huge\rightleftharpoons}\ \ \ }}}  {\large \frac{1}{x}}$$<br> <br> NOTE: Differentiation produces a "child" function from a "parent" function. The child is the derivative of the parent. Putting the relationship the other way, the parent is the **anti-derivative** of the child. "Derivative" and "anti-derivative" are two ways of looking at the same relationship between a pair of functions. So, if $f(x)$ is the derivative of $F(x)$, then $F(x)$ is the anti-derivative of $f(x)$. )",
r"(Reciprocal $1/x$)" = r"(The derivative of the reciprocal is $- x^{-2}$.)",
  r"(+Logarithm $\ln(x)$+)" = r"(The derivative of the logarithm is the reciprocal $1/x$.)",
  r"(Sinusoid $\sin(x)$)" = r"(The derivative of a sinusoid is a shifted sinusoid.)",
  r"(Gaussian $\text{dnorm(x)}$)" = r"(The derivative of the gaussian is $- x \text{dnorm}(x)$, which is NOT one of our pattern book functions..)",
  r"(Constant $1$)" = r"(The derivative of the constant function is the zero function.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-3, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which pattern-book function is the **anti-derivative** of the gaussian $\text{dnorm()}$? That is, $${\LARGE ?}  \underset{\scriptsize \text{anti-diff}}{{\stackrel{\text{diff}}{\ \ \ \ {\Huge\rightleftharpoons}\ \ \ }}}  {\large \text{dnorm}(x)}$$<br> <br> NOTE: Differentiation produces a "child" function from a "parent" function. The child is the derivative of the parent. Putting the relationship the other way, the parent is the **anti-derivative** of the child. "Derivative" and "anti-derivative" are two ways of looking at the same relationship between a pair of functions. So, if $f(x)$ is the derivative of $F(x)$, then $F(x)$ is the anti-derivative of $f(x)$. In other words: $${\large F(x)}  \underset{\scriptsize \text{anti-diff}}{{\stackrel{\text{diff}}{\ \ \ \ {\Huge\rightleftharpoons}\ \ \ }}}  {\Large f(x)}$$ )",
r"(Reciprocal $1/x$)" = r"(The derivative of the reciprocal is $- x^{-2}$.)",
  r"(Logarithm $\ln(x)$)" = r"(The derivative of the logarithm is the reciprocal $1/x$.)",
  r"(+Sigmoid $\text{pnorm(x)}$+)" = r"(The derivative of the sigmoid is a gaussian.)",
  r"(Gaussian $\text{dnorm(x)}$)" = r"(The derivative of the gaussian is $- x \text{dnorm}(x)$, which is NOT one of our pattern book functions..)",
  r"(Constant $1$)" = r"(The derivative of the constant function is the zero function.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-4, echo=FALSE, results='markup'}
askMC(
  prompt = r"(What is the **derivative** of the power-law function $x^p$?i That is, $${\Large x^p}  \underset{\scriptsize \text{anti-diff}}{{\stackrel{\text{diff}}{\ \ \ \ {\Huge\rightleftharpoons}\ \ \ }}}  {\LARGE ?}$$   )",
r"($p\, x^p$)" = r"( )",
  r"($(p-1)\, x^p$)" = r"( )",
  r"(+$p\, x^{p-1}$+)" = r"( )",
  r"($(p-1)\, x^{p-1}$)" = r"( )",
  r"($\frac{1}{p} x^{p+1}$)" = r"( )",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-5, echo=FALSE, results='markup'}
askMC(
  prompt = r"(There are two pattern-book functions whose **second** derivative is proportional to the function itself. Which are they?  )",
r"(+Exponential and sinusoid+)" = r"( )",
  r"(Exponential and sigmoid)" = r"(The second derivative of the sigmoid is $-x\, \text{dnorm}(x)$.)",
  r"(Exponential and logarithm)" = r"(The second derivative of the logarithm is $-x^{-2}$)",
  r"(Sinusoid and gaussian)" = r"(The second derivative of the gaussian is far from obvious at first glance: $(x^2 - 1) \text{dnorm}(x)$. Don't freak out; you aren't expected to memorize this one!)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-6, echo=FALSE, results='markup'}
askMC(
  prompt = r"(What is the **derivative** of $t^5$ with respect to $t$? That is, $${\Large t^5}  \underset{\scriptsize \text{anti-diff}}{{\stackrel{\text{diff}}{\ \ \ \ {\Huge\rightleftharpoons}\ \ \ }}}  {\Large ?}$$)",
r"(+$5 t^4$+)" = r"( )",
  r"($4 t^5$)" = r"(Remember, $\partial_t t^p = p\, t^{p-1}$)",
  r"($\frac{1}{5} t^4$)" = r"( )",
  r"($\frac{1}{4} t^5$)" = r"( )",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-7, echo=FALSE, results='markup'}
askMC(
  prompt = r"(What is $\partial_x x^2$?  )",
r"($2 x$)" = r"(As per the power-law rule for differentiation.)",
  r"(+$2$+)" = r"( )",
  r"($2 x^2$)" = r"( )",
  r"($2/x$)" = r"( )",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-8, echo=FALSE, results='markup'}
askMC(
  prompt = r"(What is $\partial_t \sin(x)$   )",
r"($\cos(x)$)" = r"(Tricked you! We asked about the partial with respect to $t$, not the partial with respect to $x$. There's no $t$ in $\sin(x)$. So far as $t$ is concerned, $\sin(x)$ is a constant.)",
  r"(+0+)" = r"( )",
  r"($-\sin(x)$)" = r"(Tricked you! We asked about the partial with respect to $t$, not the partial with respect to $x$. There's no $t$ in $\sin(x)$. So far as $t$ is concerned, $\sin(x)$ is a constant.)",
  r"($-\cos(x)$)" = r"(Tricked you! We asked about the partial with respect to $t$, not the partial with respect to $x$. There's no $t$ in $\sin(x)$. So far as $t$ is concerned, $\sin(x)$ is a constant.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-9, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Suppose you know only this one fact about $f(x)$, that $\partial_{xx}\, f(7.3) = 1.6$. Which of these statements must be true?  )",
  r"($f(x)$ is increasing at $x=7.3$.)" = r"(The first derivative $\partial_x f(x)$ would tell you about whether the function is increasing or decreasing. The second derivative $\partial_{xx} f(x)$ tells you about something else.)",
  r"($f(x)$ is concave up and decreasing at $x=7.3$)" = r"(Second derivatives tell you about concavity, but not about whether the function is increasing or decreasing.)",
  r"(+$f(x)$ is concave up at $x=7.3$+)" = r"(The 2nd derivative tells you **only** about the concavity of a function. It has nothing to say about the value of the slope.)",
  r"($f(x)$ is concave up at $x=7.3$, but eventually it will become concave down.)" = r"(In a graph of a function, the second derivative corresponds to concavity. But knowing only the numerical value for the second derivative at a single input value does not tell you what the function is doing anywhere else.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-10, echo=FALSE, results='markup'}
askMC(
  prompt = r"(If $f(x)$ is discontinuous at $x=5$, can it possibly be **smooth** at $x=6$?  )",
r"(+Yes+)" = r"(Discontinuity of a function at one input doesn't tell you what the function is doing at another input.)",
  r"(No)" = r"(We told you something about $f(x)$ at $x=5$. Just knowing that doesn't tell you about $f(x)$ at other inputs.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-11, echo=FALSE, results='markup'}
askMC(
  prompt = r"(If $g(x)$ is discontinuous at $x=1$, what will be the value of $\partial_x g(x)$ at $x=1$?   )",
r"(Depends on how big the gap is at the discontinuity.)" = r"( )",
  r"(0)" = r"( )",
  r"($1/x$)" = r"( )",
  r"(+The derivative isn't defined at a discontinuity.+)" = r"( )",
  random_answer_order=FALSE
)
```



```{r drill-Pattern-book-derivs-12, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which of the following is the correct construction for $\partial_t g(t)$?   )",
r"(+$\lim_{h \rightarrow 0} \frac{g(t + h) - g(t)}{h}$+)" = r"( )",
  r"($\lim_{h \rightarrow 0} \frac{g(t + h) - g(t)}{t}$)" = r"(The division should be by $h$, not by $t$.)",
  r"($\lim_{h \rightarrow 0} \frac{g(t) - g(t+h)}{h}$)" = r"(This will be the $- \partial_t g(t)$.)",
  r"($\lim_{x \rightarrow 0} \frac{g(t + h) - g(t)}{h}$)" = r"($x$ has nothing to do with it, so $\lim_{x \rightarrow 0}$ means nothing in this context.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-13, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which of these is a reasonable definition of a derivative?   )",
r"(+A derivative is a function whose value tells, for any input, the instantaneous rate of change of the function from which it was derived.+)" = r"( )",
  r"(A derivative is the slope of a function.)" = r"(For functions that aren't straight lines, it doesn't mean anything to speak of "the slope" because the slope varies from place to place. Always remember that the derivative of a function is another **function**.)",
  r"(A derivative is a function whose value tells, for any input, the instantaneous change of the function from which it was derived.)" = r"(Not a bad start but a crucial word was left out. It should say, "the instantaneous **rate** of change". "Instantaneous" and "rate" go hand in hand.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-14, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which one of these is **not** the derivative of a pattern-book function?   )",
r"(Reciprocal)" = r"(The reciprocal is the derivative of the logarithm.)",
  r"(Zero)" = r"(Zero is the derivative of the constant function.)",
  r"(One)" = r"(The constant function 1 is the derivative of the identity function $x$.)",
  r"(+Sigmoid+)" = r"(There is some function whose derivative is the sigmoid, but it's not a function that we've discussed and it's not much (or ever!?) used in modeling.)",
  random_answer_order=TRUE
)
```



```{r drill-Pattern-book-derivs-15, echo=FALSE, results='markup'}
askMC(
  prompt = r"(Which of the following shapes of functions is **not** allowed? You are **strongly** advised to try to draw each shape.  )",
r"(Increasing and concave up.)" = r"( )",
  r"(Decreasing and concave up.)" = r"( )",
  r"(Increasing and concave down.)" = r"( )",
  r"(Decreasing and concave down.)" = r"( )",
  r"(None of them are allowed.)" = r"( )",
  r"(+All of them are allowed.+)" = r"(The only restriction on mathematical functions is that for any given input, there can be at most one output.)",
  random_answer_order=FALSE
)
```
